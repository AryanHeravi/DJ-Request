<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Song Request</title>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<style>
body {
  margin: 0;
  background: radial-gradient(circle at top, #111, #000);
  font-family: Montserrat, sans-serif;
  color: #eaeaea;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.container {
  width: 90%;
  max-width: 420px;
  text-align: center;
}

.status {
  font-size: 0.75rem;
  letter-spacing: 3px;
  margin-bottom: 0.4rem;
}
.status.open { color: #00ff9c; }
.status.closed { color: #ff4d4d; }

.countdown {
  font-size: 0.8rem;
  color: #aaa;
  margin-bottom: 1rem;
}

.note {
  font-size: 0.75rem;
  color: #777;
  line-height: 1.4;
  margin-bottom: 1.2rem;
}

h1 {
  font-size: 1.9rem;
  margin-bottom: 1.2rem;
}

input {
  width: 100%;
  padding: 14px;
  margin-bottom: 1rem;
  background: #0e0e0e;
  border: 1px solid #222;
  border-radius: 10px;
  color: #fff;
}

button {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: none;
  font-size: 1rem;
  cursor: pointer;
}

.submit-btn {
  background: linear-gradient(135deg, #ff0066, #ff4d4d);
  color: #fff;
}

.review-btn,
.paypal-btn {
  background: #111;
  border: 1px solid #333;
  color: #fff;
  margin-top: 0.7rem;
}

.hidden { display: none; }

.tip-note {
  font-size: 0.85rem;
  color: #aaa;
  margin: 0.8rem 0;
}
</style>
</head>

<body>
<div class="container">

  <div id="status" class="status"></div>
  <div id="countdown" class="countdown"></div>

  <div id="note" class="note hidden">
    We appreciate you using this song request web app.<br>
    Please use it <strong>Thursday â€“ Monday, 8:00 PM â€“ 2:00 AM</strong>.
  </div>

  <form id="songForm">
    <h1 id="headline">Request a Track</h1>

    <input name="song" placeholder="Song name" required />
    <input name="artist" placeholder="Artist" required />
    <input name="name" placeholder="Your name (optional)" />

    <button class="submit-btn" type="submit">Send Request</button>
  </form>

  <div id="thankYou" class="hidden">
    <h1>Request Sent</h1>

    <div class="tip-note">
      Thanks for submitting a song request.<br>
      If approved, it will be played shortly.<br><br>
      ðŸ’¸ Tip jar is beside the DJ booth â€” always appreciated.
    </div>

    <a href="https://reviewthis.biz/gr989" target="_blank">
      <button class="review-btn">Leave a Google Review</button>
    </a>

    <a href="https://www.paypal.me/YOURPAYPAL" target="_blank">
      <button class="paypal-btn">Tip via PayPal</button>
    </a>
  </div>

</div>

<script>
// ==========================
// ðŸ”§ TEST MODE
// ==========================
const FORCE_OPEN = true; // â† set to false before your shift

emailjs.init('6o_OSihC1KZB6rAKo');

const form = document.getElementById('songForm');
const thankYou = document.getElementById('thankYou');
const statusEl = document.getElementById('status');
const countdownEl = document.getElementById('countdown');
const headline = document.getElementById('headline');
const note = document.getElementById('note');

function isOpenNow() {
  const now = new Date();
  const day = now.getDay(); // 0 Sun â†’ 6 Sat
  const hour = now.getHours();
  const min = now.getMinutes();

  if (FORCE_OPEN) return { open: true, hour, min };

  const open =
    (day === 4 && hour >= 20) || // Thu night
    (day === 5 && hour < 2) ||
    (day === 5 && hour >= 20) ||
    (day === 6 && hour < 2) ||
    (day === 6 && hour >= 20) ||
    (day === 0 && hour < 2) ||
    (day === 0 && hour >= 20) ||
    (day === 1 && hour < 2) ||
    (day === 1 && hour >= 20) ||
    (day === 2 && hour < 2);

  return { open, hour, min };
}

function getNextOpen() {
  const now = new Date();
  for (let i = 0; i < 7; i++) {
    const d = new Date(now);
    d.setDate(now.getDate() + i);
    d.setHours(20, 0, 0, 0);
    if ([4,5,6,0,1].includes(d.getDay()) && d > now) return d;
  }
}

function updateCountdown(target) {
  const diff = target - new Date();
  const d = Math.floor(diff / 86400000);
  const h = Math.floor((diff % 86400000) / 3600000);
  const m = Math.floor((diff % 3600000) / 60000);
  const s = Math.floor((diff % 60000) / 1000);
  countdownEl.textContent = `Opens in ${d}d ${h}h ${m}m ${s}s`;
}

function updateUI() {
  const { open, hour, min } = isOpenNow();

  if (open) {
    statusEl.textContent = FORCE_OPEN ? "OPEN (TEST MODE)" : "OPEN";
    statusEl.className = "status open";
    countdownEl.textContent = "";
    note.classList.add('hidden');

    headline.textContent =
      (hour === 1 && min >= 30)
        ? "Last Call for Requests"
        : "Request a Track";

    form.classList.remove('hidden');
  } else {
    statusEl.textContent = "CLOSED";
    statusEl.className = "status closed";
    form.classList.add('hidden');
    note.classList.remove('hidden');
    updateCountdown(getNextOpen());
  }
}

setInterval(updateUI, 1000);
updateUI();

form.addEventListener('submit', e => {
  e.preventDefault();

  emailjs.sendForm(
    'service_rl9aj5f',
    'template_nrix76r',
    form
  ).then(() => {
    form.classList.add('hidden');
    thankYou.classList.remove('hidden');
  });
});
</script>
</body>
</html>
