<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Song Request</title>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<style>
body {
    margin: 0;
    background: radial-gradient(circle at top, #111, #000);
    font-family: 'Montserrat', sans-serif;
    color: #eaeaea;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

.container {
    width: 90%;
    max-width: 420px;
    text-align: center;
}

.status {
    font-size: 0.85rem;
    letter-spacing: 2px;
    margin-bottom: 0.5rem;
}

.status.open { color: #00ff9c; }
.status.closed { color: #ff4d4d; }

.countdown {
    font-size: 0.95rem;
    color: #aaa;
    margin-bottom: 1rem;
}

.note {
    font-size: 0.8rem;
    color: #777;
    line-height: 1.4;
    margin-bottom: 1.2rem;
}

h1 {
    font-size: 2rem;
    margin-bottom: 1.2rem;
}

input {
    width: 100%;
    padding: 14px;
    margin-bottom: 1rem;
    background: #0e0e0e;
    border: 1px solid #222;
    border-radius: 10px;
    color: #fff;
    font-size: 1rem;
}

button {
    width: 100%;
    padding: 14px;
    background: linear-gradient(135deg, #ff0066, #ff4d4d);
    border: none;
    border-radius: 12px;
    color: #fff;
    font-size: 1rem;
    cursor: pointer;
}

.hidden { display: none; }

.thank-you {
    font-size: 1.1rem;
    margin-bottom: 1rem;
}

.tip-note {
    font-size: 0.9rem;
    color: #aaa;
    margin-bottom: 1rem;
}

.review-btn {
    background: #1a1a1a;
    border: 1px solid #333;
}
</style>
</head>

<body>
<div class="container">
    <h1>GRANVILLE WAREHOUSE</h1> 
    <h1>SONG REQUEST</h1>
    <div id="status" class="status"></div>
    <div id="countdown" class="countdown"></div>
    
    <div id="note" class="note hidden">
        We appreciate you using this song request web app.<br>
        Please use it <strong>Thursday to Monday, 8:00 PM â€“ 2:00 AM</strong>.
    </div>

    <form id="songForm">
        <h1 id="headline">Request a Track</h1>

        <input type="text" name="song" placeholder="Song name" required />
        <input type="text" name="artist" placeholder="Artist" required />
        <input type="text" name="name" placeholder="Your name (optional)" />

        <button type="submit">Send Request</button>
    </form>

    <div id="thankYou" class="hidden">
        <div class="thank-you">
            Thanks for submitting a song request.<br>
            If approved, it will be played shortly.
        </div>

        <div class="tip-note">
            ðŸ’¸ Tip jar beside the DJ booth â€” always appreciated.
        </div>

        <a href="https://reviewthis.biz/gr989" target="_blank">
            <button class="review-btn">Leave a Google Review</button>
        </a>
    </div>

</div>

<script>
emailjs.init('6o_OSihC1KZB6rAKo');

const form = document.getElementById('songForm');
const thankYou = document.getElementById('thankYou');
const statusEl = document.getElementById('status');
const countdownEl = document.getElementById('countdown');
const headline = document.getElementById('headline');
const note = document.getElementById('note');

const workingDays = [0,1,4,5,6]; // Sun, Mon, Thu, Fri, Sat
const openHour = 20;

function getNextOpening() {
    const now = new Date();

    for (let i = 0; i < 7; i++) {
        const d = new Date(now);
        d.setDate(now.getDate() + i);
        d.setHours(openHour,0,0,0);

        if (workingDays.includes(d.getDay()) && d > now) {
            return d;
        }
    }
}

function isOpen() {
    const now = new Date();
    const day = now.getDay();
    const hour = now.getHours();
    const min = now.getMinutes();

    const isDay = workingDays.includes(day);
    const isHour =
        (hour >= 20 && hour <= 23) ||
        (hour >= 0 && hour < 2);

    return { isDay, isHour, hour, min };
}

function updateCountdown(target) {
    const now = new Date();
    const diff = target - now;

    const days = Math.floor(diff / 86400000);
    const hours = Math.floor((diff % 86400000) / 3600000);
    const minutes = Math.floor((diff % 3600000) / 60000);
    const seconds = Math.floor((diff % 60000) / 1000);

    countdownEl.textContent =
        `Requests open in ${days}d ${hours}h ${minutes}m ${seconds}s`;
}

function updateUI() {
    const now = new Date();
    const { isDay, isHour, hour, min } = isOpen();

    if (isDay && isHour) {
        statusEl.textContent = "OPEN";
        statusEl.className = "status open";
        countdownEl.textContent = "";
        note.classList.add('hidden');

        headline.textContent =
            (hour === 1 && min >= 30)
            ? "Last Call for Requests"
            : "Request a Track";

        form.classList.remove('hidden');
    } else {
        statusEl.textContent = "CLOSED";
        statusEl.className = "status closed";
        form.classList.add('hidden');
        note.classList.remove('hidden');

        const nextOpen = getNextOpening();
        updateCountdown(nextOpen);
    }
}

setInterval(updateUI, 1000);
updateUI();

form.addEventListener('submit', function(e) {
    e.preventDefault();

    emailjs.sendForm(
        'service_rl9aj5f',
        'template_nrix76r',
        this
    ).then(() => {
        form.classList.add('hidden');
        thankYou.classList.remove('hidden');
    });
});
</script>
</body>
</html>
